<html>
    <head>
        <title>Chatbot_GitHub</title>
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    </head>
    <body>
        
        <div align="center">DevMerge BOT - V45</div>

        <script type='text/javascript'>
            
            // Pre-chat event listener. Add this somewhere inside the page where the 
            window.addEventListener("onEmbeddedMessagingReady", () => {
                console.log("Received the onEmbeddedMessagingReady event");
            
                // Fill these values through JavaScript to send data to Salesforce
                // All fields must be of type String and no longer than 100 characters
                embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
                    "UserId" : "1029488393", // CAT User Identifier (Unique Key)
                    "AccountId" : "8874788222", // CAT Customer Identifier (Unique Key)
                    "FirstName" : "Mario", // User First Name
                    "LastName" : "Rossi", // User Last Name
                    "Email" : "" // User Email
                });

                // Set ChatBot Specs
                let changeMap = new Map();
                changeMap.set("button", true);
                changeMap.set("z-index", true);
                let setChatSpecs = setInterval(function(){
                    // Set z-index
                    if(changeMap.get("z-index") && document.getElementById("embedded-messaging") != null){
                        console.log("Setting z-index");
                        changeMap.set("z-index", false);
                        document.getElementById("embedded-messaging").style.zindex = "1000";
                    }
                    // Set Chat icon
                    if(changeMap.get("button") && document.getElementById("embeddedMessagingConversationButton") != null){
                        console.log("Setting button");
                        changeMap.set("button", false);
                        // Create icon
                        let img = document.createElement('img');
                        img.src = "IconTop+TextBelow-LG@1x.png";
                        img.style.pointerEvents = "none";
                        img.style.position = "fixed";
                        img.style.bottom = "25px";
                        img.style.right = "0px";
                        img.id = "buttonIcon";
                        // Set buttonWrapper
                        let buttonWrapper = document.querySelector(".embeddedMessagingConversationButtonWrapper");
                        buttonWrapper.addEventListener("mouseover", () => {
                            document.getElementById("buttonIcon").style.filter = "brightness(0.5)";
                        });
                        buttonWrapper.addEventListener("mouseout", () => {
                            document.getElementById("buttonIcon").style.filter = "brightness(1.0)";
                        });
                        buttonWrapper.addEventListener("click", () => {
                            setTimeout(updateButtonMin, 200);
                        });
                        buttonWrapper.appendChild(img);
                        buttonWrapper.style.boxShadow = "none";
                        // Set button
                        let button = document.getElementById("embeddedMessagingConversationButton");
                        button.style.right = "0";
                        button.style.width = "48px";
                        button.style.height = "48px";
                        button.style.boxShadow = "none";
                    }
                }, 50);
                setTimeout(function(){
                    clearInterval(setChatSpecs); 
                }, 5000);

                // Update minimized button
                function updateButtonMin() {
                    let buttonMin = document.querySelector(".minimizedButton,.testExist");
                    console.log('checkDOMChange: '+buttonMin);
                    if(buttonMin == null) {
                        console.log('still null');
                        buttonMin = document.getElementById("minimizedButton-18");
                    }
                    if(buttonMin != null) {
                        console.log('FOUND IT!');
                        buttonMin.style.right = "0";
                        buttonMin.style.width = "48px";
                        buttonMin.style.height = "48px";
                        buttonMin.style.boxShadow = "none";
                        buttonMin.addEventListener("mouseover", () => {
                            document.getElementById("buttonIcon").style.filter = "brightness(0.5)";
                        });
                        buttonMin.addEventListener("mouseout", () => {
                            document.getElementById("buttonIcon").style.filter = "brightness(1.0)";
                        });
                    } else {
                        setTimeout(updateButtonMin, 100);
                    }
                }

                // Update minimized button
                //checkDOMChange();
                function checkDOMChange() {
                    let buttonMin = document.querySelector(".minimizedButton");
                    console.log('checkDOMChange: '+buttonMin);
                    if(buttonMin != null) {
                        console.log('FOUND IT!');
                        buttonMin.style.right = "0";
                        buttonMin.style.width = "48px";
                        buttonMin.style.height = "48px";
                        buttonMin.style.boxShadow = "none";
                    } else {
                        setTimeout(checkDOMChange, 100);
                    }
                }
            });
            
        	function initEmbeddedMessaging() {
        		try {
        			embeddedservice_bootstrap.settings.language = 'it'; // Set Language
                    embeddedservice_bootstrap.settings.widgetWidth = '50%'; // Set size
        
        			embeddedservice_bootstrap.init(
        				'00DDH00000057Ze',
        				'CGT_Bot_Web_Deployment',
        				'https://cgtspa--devmerge.sandbox.my.site.com/ESWCGTBotWebDeployment1697542037993',
        				{
        					scrt2URL: 'https://cgtspa--devmerge.sandbox.my.salesforce-scrt.com'
        				}
        			);
        		} catch (err) {
        			console.error('Error loading Embedded Messaging: ', err);
        		}
        	};
        </script>


        
        <script>
            setTimeout(updateButtonMin2, 100);
            function updateButtonMin2() {
                let buttonMin = document.querySelector(".minimizedButton,.testExist");
                console.log('checkDOMChange: '+buttonMin);
                if(buttonMin == null) {
                    console.log('still null');
                    buttonMin = document.getElementById("minimizedButton-18");
                }
                console.log(document.body.serializeWithStyles());
                if(buttonMin != null) {
                    console.log('FOUND IT!');
                    buttonMin.style.right = "0";
                    buttonMin.style.width = "48px";
                    buttonMin.style.height = "48px";
                    buttonMin.style.boxShadow = "none";
                    buttonMin.addEventListener("mouseover", () => {
                        document.getElementById("buttonIcon").style.filter = "brightness(0.5)";
                    });
                    buttonMin.addEventListener("mouseout", () => {
                        document.getElementById("buttonIcon").style.filter = "brightness(1.0)";
                    });
                } else {
                    setTimeout(updateButtonMin2, 100);
                }
            }
        </script>


        
        <script type='text/javascript' src='https://cgtspa--devmerge.sandbox.my.site.com/ESWCGTBotWebDeployment1697542037993/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>

    </body>
</html>
